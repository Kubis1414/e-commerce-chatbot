{
  "flow_runs": [
    {
      "run_id": "9ef7833c-b4c2-48ae-94e2-40c49f272ea3_0",
      "status": "Failed",
      "error": {
        "message": "Flow execution failed. The section 'search_query' of reference is currently unsupported. Please specify the output part of the node 'process_query'.",
        "messageFormat": "Flow execution failed. The section '{reference_section}' of reference is currently unsupported. Please specify the output part of the node '{reference_node_name}'.",
        "messageParameters": {
          "reference_node_name": "process_query",
          "reference_section": "search_query"
        },
        "referenceCode": "Unknown",
        "code": "UserError",
        "innerError": {
          "code": "NodeReferenceError",
          "innerError": {
            "code": "UnsupportedReference",
            "innerError": null
          }
        },
        "debugInfo": {
          "type": "UnsupportedReference",
          "message": "Flow execution failed. The section 'search_query' of reference is currently unsupported. Please specify the output part of the node 'process_query'.",
          "stackTrace": "Traceback (most recent call last):\n  File \"/Users/martinkubanek/Documents/VŠE/Bakalářka/chat/.venv/lib/python3.9/site-packages/promptflow/executor/flow_executor.py\", line 1034, in _exec\n    output, aggregation_inputs = self._exec_inner_with_trace(\n  File \"/Users/martinkubanek/Documents/VŠE/Bakalářka/chat/.venv/lib/python3.9/site-packages/promptflow/executor/flow_executor.py\", line 937, in _exec_inner_with_trace\n    output, nodes_outputs = self._traverse_nodes(inputs, context)\n  File \"/Users/martinkubanek/Documents/VŠE/Bakalářka/chat/.venv/lib/python3.9/site-packages/promptflow/executor/flow_executor.py\", line 1215, in _traverse_nodes\n    nodes_outputs, bypassed_nodes = self._submit_to_scheduler(context, inputs, batch_nodes)\n  File \"/Users/martinkubanek/Documents/VŠE/Bakalářka/chat/.venv/lib/python3.9/site-packages/promptflow/executor/flow_executor.py\", line 1270, in _submit_to_scheduler\n    return scheduler.execute(self._line_timeout_sec)\n  File \"/Users/martinkubanek/Documents/VŠE/Bakalářka/chat/.venv/lib/python3.9/site-packages/promptflow/executor/_flow_nodes_scheduler.py\", line 131, in execute\n    raise e\n  File \"/Users/martinkubanek/Documents/VŠE/Bakalářka/chat/.venv/lib/python3.9/site-packages/promptflow/executor/_flow_nodes_scheduler.py\", line 113, in execute\n    self._dag_manager.complete_nodes(self._collect_outputs(completed_futures))\n  File \"/Users/martinkubanek/Documents/VŠE/Bakalářka/chat/.venv/lib/python3.9/site-packages/promptflow/executor/_flow_nodes_scheduler.py\", line 160, in _collect_outputs\n    each_node_result = each_future.result()\n  File \"/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py\", line 438, in result\n    return self.__get_result()\n  File \"/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py\", line 390, in __get_result\n    raise self._exception\n  File \"/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/thread.py\", line 52, in run\n    result = self.fn(*self.args, **self.kwargs)\n  File \"/Users/martinkubanek/Documents/VŠE/Bakalářka/chat/.venv/lib/python3.9/site-packages/promptflow/executor/_flow_nodes_scheduler.py\", line 176, in _exec_single_node_in_thread\n    kwargs = dag_manager.get_node_valid_inputs(node, f)\n  File \"/Users/martinkubanek/Documents/VŠE/Bakalářka/chat/.venv/lib/python3.9/site-packages/promptflow/executor/_dag_manager.py\", line 77, in get_node_valid_inputs\n    results[name] = self._get_node_dependency_value(i)\n  File \"/Users/martinkubanek/Documents/VŠE/Bakalářka/chat/.venv/lib/python3.9/site-packages/promptflow/executor/_dag_manager.py\", line 151, in _get_node_dependency_value\n    return _input_assignment_parser.parse_value(node_dependency, self._completed_nodes_outputs, self._flow_inputs)\n  File \"/Users/martinkubanek/Documents/VŠE/Bakalářka/chat/.venv/lib/python3.9/site-packages/promptflow/executor/_input_assignment_parser.py\", line 35, in parse_value\n    raise UnsupportedReference(\n",
          "innerException": null
        }
      },
      "inputs": {
        "user_query": "jak se máš"
      },
      "output": null,
      "metrics": null,
      "request": null,
      "parent_run_id": "9ef7833c-b4c2-48ae-94e2-40c49f272ea3",
      "root_run_id": "9ef7833c-b4c2-48ae-94e2-40c49f272ea3",
      "source_run_id": null,
      "flow_id": "default_flow_id",
      "start_time": "2025-03-01T21:17:22.157332Z",
      "end_time": "2025-03-01T21:17:26.874371Z",
      "index": 0,
      "api_calls": [
        {
          "name": "flow",
          "node_name": "flow",
          "type": "Flow",
          "start_time": 1740860242.157332,
          "end_time": 1740860246.874371,
          "children": [
            {
              "name": "process_query",
              "type": "Function",
              "inputs": {
                "user_query": "jak se máš"
              },
              "output": "Samozřejmě, prosím, poskytněte mi dotaz zákazníka, abych mohl extrahovat klíčová slova.",
              "start_time": 1740860242.158233,
              "end_time": 1740860246.836691,
              "error": null,
              "children": [
                {
                  "name": "openai_chat",
                  "type": "LLM",
                  "inputs": {
                    "messages": [
                      {
                        "content": "Jsi asistent pro extrakci klíčových slov z dotazů zákazníků e-shopu.",
                        "role": "system"
                      },
                      {
                        "content": "Na základě následujícího dotazu zákazníka e-shopu extrahuj klíčová slova, která nejlépe vystihují, co zákazník hledá.\nTato klíčová slova budou použita pro vyhledávání v databázi produktů.\n\nDotaz zákazníka: \"{ user_query }\"\n\nExtrahuj pouze podstatná klíčová slova, která reprezentují:\n1. Typy produktů, které zákazník hledá\n2. Vlastnosti nebo funkce, které zákazník požaduje\n3. Značky nebo kategorie, které zákazník zmínil\n\nVýstup by měl být stručný (maximálně 10 slov) a obsahovat pouze klíčová slova oddělená mezerami, bez interpunkce.\n",
                        "role": "user"
                      }
                    ],
                    "model": "gpt-4o",
                    "stream": false,
                    "temperature": 0.1
                  },
                  "output": {
                    "id": "chatcmpl-B6OV3ZoMFUYFrdgvNuTLE4jGE0bzh",
                    "choices": [
                      {
                        "finish_reason": "stop",
                        "index": 0,
                        "logprobs": null,
                        "message": {
                          "content": "Samozřejmě, prosím, poskytněte mi dotaz zákazníka, abych mohl extrahovat klíčová slova.",
                          "refusal": null,
                          "role": "assistant",
                          "audio": null,
                          "function_call": null,
                          "tool_calls": null
                        }
                      }
                    ],
                    "created": 1740863845,
                    "model": "gpt-4o-2024-08-06",
                    "object": "chat.completion",
                    "service_tier": "default",
                    "system_fingerprint": "fp_eb9dce56a8",
                    "usage": {
                      "completion_tokens": 33,
                      "prompt_tokens": 211,
                      "total_tokens": 244,
                      "completion_tokens_details": {
                        "accepted_prediction_tokens": 0,
                        "audio_tokens": 0,
                        "reasoning_tokens": 0,
                        "rejected_prediction_tokens": 0
                      },
                      "prompt_tokens_details": {
                        "audio_tokens": 0,
                        "cached_tokens": 0
                      }
                    }
                  },
                  "start_time": 1740860242.20069,
                  "end_time": 1740860246.83527,
                  "error": null,
                  "children": [],
                  "node_name": null,
                  "parent_id": "a058f4a3-11d0-4416-a1d9-9fd099784e97",
                  "id": "63c0df81-dacd-448a-a13f-f0e4c0310bf7",
                  "function": "openai.resources.chat.completions.completions.Completions.create",
                  "system_metrics": {
                    "completion_tokens": 33,
                    "prompt_tokens": 211,
                    "total_tokens": 244
                  }
                }
              ],
              "node_name": "process_query",
              "parent_id": "",
              "id": "a058f4a3-11d0-4416-a1d9-9fd099784e97",
              "function": "process_query",
              "system_metrics": {
                "completion_tokens": 33,
                "prompt_tokens": 211,
                "total_tokens": 244
              }
            }
          ],
          "system_metrics": {
            "duration": 4.717039,
            "prompt_tokens": 211,
            "completion_tokens": 33,
            "total_tokens": 244
          },
          "inputs": {
            "user_query": "jak se máš"
          },
          "output": null,
          "error": {
            "message": "Flow execution failed. The section 'search_query' of reference is currently unsupported. Please specify the output part of the node 'process_query'.",
            "messageFormat": "Flow execution failed. The section '{reference_section}' of reference is currently unsupported. Please specify the output part of the node '{reference_node_name}'.",
            "messageParameters": {
              "reference_node_name": "process_query",
              "reference_section": "search_query"
            },
            "referenceCode": "Unknown",
            "code": "UserError",
            "innerError": {
              "code": "NodeReferenceError",
              "innerError": {
                "code": "UnsupportedReference",
                "innerError": null
              }
            },
            "debugInfo": {
              "type": "UnsupportedReference",
              "message": "Flow execution failed. The section 'search_query' of reference is currently unsupported. Please specify the output part of the node 'process_query'.",
              "stackTrace": "Traceback (most recent call last):\n  File \"/Users/martinkubanek/Documents/VŠE/Bakalářka/chat/.venv/lib/python3.9/site-packages/promptflow/executor/flow_executor.py\", line 1034, in _exec\n    output, aggregation_inputs = self._exec_inner_with_trace(\n  File \"/Users/martinkubanek/Documents/VŠE/Bakalářka/chat/.venv/lib/python3.9/site-packages/promptflow/executor/flow_executor.py\", line 937, in _exec_inner_with_trace\n    output, nodes_outputs = self._traverse_nodes(inputs, context)\n  File \"/Users/martinkubanek/Documents/VŠE/Bakalářka/chat/.venv/lib/python3.9/site-packages/promptflow/executor/flow_executor.py\", line 1215, in _traverse_nodes\n    nodes_outputs, bypassed_nodes = self._submit_to_scheduler(context, inputs, batch_nodes)\n  File \"/Users/martinkubanek/Documents/VŠE/Bakalářka/chat/.venv/lib/python3.9/site-packages/promptflow/executor/flow_executor.py\", line 1270, in _submit_to_scheduler\n    return scheduler.execute(self._line_timeout_sec)\n  File \"/Users/martinkubanek/Documents/VŠE/Bakalářka/chat/.venv/lib/python3.9/site-packages/promptflow/executor/_flow_nodes_scheduler.py\", line 131, in execute\n    raise e\n  File \"/Users/martinkubanek/Documents/VŠE/Bakalářka/chat/.venv/lib/python3.9/site-packages/promptflow/executor/_flow_nodes_scheduler.py\", line 113, in execute\n    self._dag_manager.complete_nodes(self._collect_outputs(completed_futures))\n  File \"/Users/martinkubanek/Documents/VŠE/Bakalářka/chat/.venv/lib/python3.9/site-packages/promptflow/executor/_flow_nodes_scheduler.py\", line 160, in _collect_outputs\n    each_node_result = each_future.result()\n  File \"/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py\", line 438, in result\n    return self.__get_result()\n  File \"/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py\", line 390, in __get_result\n    raise self._exception\n  File \"/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/thread.py\", line 52, in run\n    result = self.fn(*self.args, **self.kwargs)\n  File \"/Users/martinkubanek/Documents/VŠE/Bakalářka/chat/.venv/lib/python3.9/site-packages/promptflow/executor/_flow_nodes_scheduler.py\", line 176, in _exec_single_node_in_thread\n    kwargs = dag_manager.get_node_valid_inputs(node, f)\n  File \"/Users/martinkubanek/Documents/VŠE/Bakalářka/chat/.venv/lib/python3.9/site-packages/promptflow/executor/_dag_manager.py\", line 77, in get_node_valid_inputs\n    results[name] = self._get_node_dependency_value(i)\n  File \"/Users/martinkubanek/Documents/VŠE/Bakalářka/chat/.venv/lib/python3.9/site-packages/promptflow/executor/_dag_manager.py\", line 151, in _get_node_dependency_value\n    return _input_assignment_parser.parse_value(node_dependency, self._completed_nodes_outputs, self._flow_inputs)\n  File \"/Users/martinkubanek/Documents/VŠE/Bakalářka/chat/.venv/lib/python3.9/site-packages/promptflow/executor/_input_assignment_parser.py\", line 35, in parse_value\n    raise UnsupportedReference(\n",
              "innerException": null
            }
          }
        }
      ],
      "name": "",
      "description": "",
      "tags": null,
      "system_metrics": {
        "duration": 4.717039,
        "prompt_tokens": 211,
        "completion_tokens": 33,
        "total_tokens": 244
      },
      "result": null,
      "upload_metrics": false,
      "otel_trace_id": "0x8c780a02d66f8c03845d024cf059957d",
      "message_format": "basic"
    }
  ],
  "node_runs": [
    {
      "node": "process_query",
      "flow_run_id": "9ef7833c-b4c2-48ae-94e2-40c49f272ea3",
      "run_id": "9ef7833c-b4c2-48ae-94e2-40c49f272ea3_process_query_0",
      "status": "Completed",
      "inputs": {
        "user_query": "jak se máš"
      },
      "output": "Samozřejmě, prosím, poskytněte mi dotaz zákazníka, abych mohl extrahovat klíčová slova.",
      "metrics": null,
      "error": null,
      "parent_run_id": "9ef7833c-b4c2-48ae-94e2-40c49f272ea3_0",
      "start_time": "2025-03-01T21:17:22.158180Z",
      "end_time": "2025-03-01T21:17:26.837631Z",
      "index": 0,
      "api_calls": [
        {
          "name": "process_query",
          "type": "Function",
          "inputs": {
            "user_query": "jak se máš"
          },
          "output": "Samozřejmě, prosím, poskytněte mi dotaz zákazníka, abych mohl extrahovat klíčová slova.",
          "start_time": 1740860242.158233,
          "end_time": 1740860246.836691,
          "error": null,
          "children": [
            {
              "name": "openai_chat",
              "type": "LLM",
              "inputs": {
                "messages": [
                  {
                    "content": "Jsi asistent pro extrakci klíčových slov z dotazů zákazníků e-shopu.",
                    "role": "system"
                  },
                  {
                    "content": "Na základě následujícího dotazu zákazníka e-shopu extrahuj klíčová slova, která nejlépe vystihují, co zákazník hledá.\nTato klíčová slova budou použita pro vyhledávání v databázi produktů.\n\nDotaz zákazníka: \"{ user_query }\"\n\nExtrahuj pouze podstatná klíčová slova, která reprezentují:\n1. Typy produktů, které zákazník hledá\n2. Vlastnosti nebo funkce, které zákazník požaduje\n3. Značky nebo kategorie, které zákazník zmínil\n\nVýstup by měl být stručný (maximálně 10 slov) a obsahovat pouze klíčová slova oddělená mezerami, bez interpunkce.\n",
                    "role": "user"
                  }
                ],
                "model": "gpt-4o",
                "stream": false,
                "temperature": 0.1
              },
              "output": {
                "id": "chatcmpl-B6OV3ZoMFUYFrdgvNuTLE4jGE0bzh",
                "choices": [
                  {
                    "finish_reason": "stop",
                    "index": 0,
                    "logprobs": null,
                    "message": {
                      "content": "Samozřejmě, prosím, poskytněte mi dotaz zákazníka, abych mohl extrahovat klíčová slova.",
                      "refusal": null,
                      "role": "assistant",
                      "audio": null,
                      "function_call": null,
                      "tool_calls": null
                    }
                  }
                ],
                "created": 1740863845,
                "model": "gpt-4o-2024-08-06",
                "object": "chat.completion",
                "service_tier": "default",
                "system_fingerprint": "fp_eb9dce56a8",
                "usage": {
                  "completion_tokens": 33,
                  "prompt_tokens": 211,
                  "total_tokens": 244,
                  "completion_tokens_details": {
                    "accepted_prediction_tokens": 0,
                    "audio_tokens": 0,
                    "reasoning_tokens": 0,
                    "rejected_prediction_tokens": 0
                  },
                  "prompt_tokens_details": {
                    "audio_tokens": 0,
                    "cached_tokens": 0
                  }
                }
              },
              "start_time": 1740860242.20069,
              "end_time": 1740860246.83527,
              "error": null,
              "children": [],
              "node_name": null,
              "parent_id": "a058f4a3-11d0-4416-a1d9-9fd099784e97",
              "id": "63c0df81-dacd-448a-a13f-f0e4c0310bf7",
              "function": "openai.resources.chat.completions.completions.Completions.create",
              "system_metrics": {
                "completion_tokens": 33,
                "prompt_tokens": 211,
                "total_tokens": 244
              }
            }
          ],
          "node_name": "process_query",
          "parent_id": "",
          "id": "a058f4a3-11d0-4416-a1d9-9fd099784e97",
          "function": "process_query",
          "system_metrics": {
            "completion_tokens": 33,
            "prompt_tokens": 211,
            "total_tokens": 244
          }
        }
      ],
      "cached_run_id": null,
      "cached_flow_run_id": null,
      "logs": {
        "stdout": "",
        "stderr": "[2025-03-01T21:17:22+0000] /Users/martinkubanek/Documents/VŠE/Bakalářka/chat/flow/process_query.py:33: LangChainDeprecationWarning: The class `LLMChain` was deprecated in LangChain 0.1.17 and will be removed in 1.0. Use :meth:`~RunnableSequence, e.g., `prompt | llm`` instead.\n  chain = LLMChain(llm=llm, prompt=prompt)\n"
      },
      "system_metrics": {
        "completion_tokens": 33,
        "prompt_tokens": 211,
        "total_tokens": 244,
        "duration": 4.679451
      },
      "result": "Samozřejmě, prosím, poskytněte mi dotaz zákazníka, abych mohl extrahovat klíčová slova.",
      "message_format": "basic"
    }
  ]
}